# 从输入 URL 到页面展示的完整流程

当您在浏览器地址栏输入一个URL并按下回车键后，浏览器会经历一系列步骤，将对应的网页呈现给您。以下是这个过程的详细描述：

## 1. URL 解析
浏览器首先解析输入的 URL，确定所使用的协议（如 HTTP 或 HTTPS）、主机名（域名）、端口号（如果有指定）、路径以及查询参数等。

## 2. 检查缓存
在发起网络请求之前，浏览器会先检查本地缓存中是否已有所需资源。如果缓存中存在且未过期，浏览器将直接使用缓存内容，避免重复请求。

## 3. DNS 解析
如果缓存中没有所需资源，浏览器会通过 DNS（域名系统）将域名转换为对应的 IP 地址。这个过程可能涉及查询本地缓存、主机文件、路由器缓存、ISP 的 DNS 缓存，或进行 DNS 递归查询。

## 4. 建立 TCP 连接
获取到服务器的 IP 地址后，浏览器与服务器之间需要建立 TCP 连接。这个过程包括三次握手：
- 客户端发送一个 SYN（同步）包，表示请求建立连接。
- 服务器收到后，返回一个 SYN-ACK（同步-确认）包，表示同意建立连接。
- 客户端再发送一个 ACK（确认）包，确认连接建立。

## 5. 发送 HTTP 请求
TCP 连接建立后，浏览器会构建 HTTP 请求，包括请求行、请求头和请求体（如果有，例如 POST 请求）。请求头中可能包含浏览器的相关信息、Cookie 等数据。

## 6. 服务器处理请求并返回响应
服务器接收到 HTTP 请求后，会根据请求内容进行处理，生成响应数据，包括：
- **响应行**（状态码，如 200 表示成功，404 表示未找到）。
- **响应头**（包含内容类型、缓存策略、服务器信息等）。
- **响应体**（如 HTML 文档、JSON 数据等）。
服务器通过 TCP 连接将响应发送回浏览器。

## 7. 浏览器接收并处理响应
浏览器接收到服务器的响应后，会解析响应头，并检查状态码：
- **1XX**（信息类响应）：临时响应，通常不直接展示。
- **2XX**（成功）：浏览器继续处理响应体。
- **3XX**（重定向）：浏览器可能会发起新的请求。
- **4XX**（客户端错误）：通常显示错误页面。
- **5XX**（服务器错误）：表示服务器端发生问题。

## 8. 渲染页面
对于 HTML 响应，浏览器会执行以下步骤：
- **解析 HTML**：将 HTML 文档解析为 DOM（文档对象模型）树结构。
- **解析 CSS**：将 CSS 解析为 CSSOM（CSS 对象模型）树，并进行样式计算。
- **构建渲染树**：结合 DOM 树和 CSSOM 树，生成渲染树，表示页面的可见结构。
- **布局（Layout）**：计算渲染树中各元素的布局信息（位置和大小）。
- **绘制（Painting）**：将布局好的元素绘制到屏幕上，呈现最终页面。

## 9. 关闭连接或保持连接
页面渲染完成后，浏览器可能会：
- 关闭与服务器的 TCP 连接（通过四次挥手完成）。
- 选择保持连接（如使用 HTTP Keep-Alive）以便复用，减少后续请求的延迟。

## 10. 后续资源加载与优化
- **预加载（Preloading）**：浏览器可能会预加载某些资源，以加快未来的访问速度。
- **异步加载（Lazy Loading）**：对于图片、脚本等资源，可能会延迟加载，优化性能。
- **浏览器优化**：现代浏览器会利用 GPU 加速、并行下载等机制提升页面渲染效率。

整个过程涉及浏览器的多个组件和机制，包括网络请求、缓存策略、DNS 解析、TCP/IP 协议、HTTP 协议以及浏览器的渲染引擎等，共同协作将您请求的网页呈现出来。

---

# 2. 为什么浏览器需要三次握手的过程,以及为什么是三次,而不是四次,两次?
在计算机网络中，**三次握手**（Three-Way Handshake）是建立可靠的 TCP 连接所采用的过程。其目的是确保通信双方都具备发送和接收数据的能力，并同步彼此的初始序列号，防止已失效的连接请求报文段突然又传送到服务端，因而产生错误。

## **三次握手的具体过程如下：**

1. **第一次握手**：客户端向服务器发送一个 SYN（同步序列号）报文，表示希望建立连接，并包含客户端的初始序列号。此时，客户端进入 SYN_SENT 状态。

2. **第二次握手**：服务器收到 SYN 报文后，回复一个 SYN-ACK（同步-确认）报文，表示同意建立连接，并包含服务器的初始序列号，同时确认收到了客户端的 SYN 报文。此时，服务器进入 SYN_RCVD 状态。

3. **第三次握手**：客户端收到服务器的 SYN-ACK 报文后，发送一个 ACK（确认）报文，确认已收到服务器的 SYN 报文。此时，客户端和服务器都进入 ESTABLISHED（连接建立）状态，双方可以开始传输数据。

## **为什么需要三次握手，而不是两次或四次？**

- **两次握手的缺陷**：如果采用两次握手，可能会导致已失效的连接请求报文段被服务器误认为是新的连接请求，进而建立错误的连接，浪费服务器资源。三次握手可以有效避免这种情况的发生。

- **三次握手的必要性**：三次握手确保了双方的发送和接收能力都正常，并同步了初始序列号，保证了数据传输的可靠性。

- **四次握手的冗余性**：三次握手已经足以确保连接的可靠建立，增加到四次握手并不会带来更多的可靠性提升，反而会增加通信的开销和延迟，降低连接建立的效率。

因此，TCP 协议采用三次握手机制，以在连接建立时达到可靠性和效率的平衡。 

# 3.四次挥手的过程,以及为什么是四次?
在计算机网络中，**四次挥手**是指在终止 TCP 连接时，客户端和服务器之间所进行的四个步骤。其目的是确保双方都已完成数据传输，并安全地关闭连接。

## **四次挥手的具体过程如下：**

1. **第一次挥手**：客户端发送一个 FIN（Finish）报文，表示它已完成数据发送，准备关闭从客户端到服务器的连接。此时，客户端进入 FIN_WAIT_1 状态。

2. **第二次挥手**：服务器收到 FIN 报文后，发送一个 ACK（确认）报文，确认已收到客户端的 FIN 请求。此时，服务器进入 CLOSE_WAIT 状态，客户端进入 FIN_WAIT_2 状态。

3. **第三次挥手**：服务器在确认已无数据需要发送后，向客户端发送一个 FIN 报文，表示服务器也准备关闭从服务器到客户端的连接。此时，服务器进入 LAST_ACK 状态。

4. **第四次挥手**：客户端收到服务器的 FIN 报文后，发送一个 ACK 报文，确认已收到服务器的 FIN 请求。此时，客户端进入 TIME_WAIT 状态，等待一段时间（通常为 2MSL，两个最大报文段生存时间）以确保服务器已收到 ACK 报文，然后客户端和服务器都进入 CLOSED 状态，连接正式关闭。

## **为什么需要四次挥手？**

这是因为 TCP 连接是全双工的，即数据传输在两个方向上是独立的。当一方完成数据发送并发出 FIN 报文时，表示该方向的数据传输已结束，但另一方可能仍有数据需要发送。因此，双方需要分别关闭各自的发送通道，这就需要四次挥手来确保双方都已完成数据传输，并安全地关闭连接。 